<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta name="viewport" content="width=device-width" />

<title>d3.js map</title>
<meta property="og:type" content="website"/>
<meta property="og:title" content="Displaying map with d3.js"/>
<meta property="og:description" content="d3.js exercises - render map and points from topojson and csv files"/>
<meta property="og:url" content="https://nyem69.github.io/datasketches/d3mapping/"/>
<meta property="og:image" content="../assets/d3mapping.png"/>
<meta name="twitter:card" content="../assets/d3mapping.png"/>
<meta name="twitter:site" content="@nyem"/>



<body>
<script src="https://d3js.org/d3.v6.min.js"></script>
<script src="https://unpkg.com/topojson@3"></script>
<script>
var width = 960,
    height = 400;

//var projection = d3.geoMercator()
//    .center([0, 5 ])
//    .scale(150)
//    .rotate([-180,0]);

var projection = d3.geoMercator()
    .center([0, 0 ])
    .scale(2800 + 5*100)
    .rotate([-109.45 + 5/2,-3]);

var svg = d3.select("body").append("svg")
//    .attr("width", width)
//    .attr("height", height);
  .attr('viewBox', [0,0,width,height].join(' ')) // fill screen
;

var path = d3.geoPath()
    .projection(projection);

var g = svg.append("g");
var my = svg.append("g").attr('class','map-malaysia');





//=====================
// from mapv4.html
//=====================

//d3.json("malaysia.json", function(error, malaysia) {
d3.json("malaysia.json").then(function(malaysia) {


  var states = topojson.feature(malaysia, malaysia.objects.states);
  var land = topojson.feature(malaysia, malaysia.objects.land);


  //=====================
  // shift sabah/sarawak/labuan closer to semenanjung
  //=====================

//  [land,states].forEach(d=>{
  [land,states].forEach(d=>{
    d.features
      .forEach(d=>{
        d.geometry.coordinates.forEach(d=>{
          if (d.length==2)  {
            _shift(d);
          }else  {
            d[0].forEach(_shift);
          }
        });
      });
  });


  function _shift(d,n)  {
    if (!n) n=0;
    n++;

    if (typeof d=='object' && d.length==2)  {

      // apple shift for longitude > 5
      if (d[0]>105) d[0] += -5;

    }

    return d;
  }


  //=====================
  //
  //=====================

  my.selectAll(".land")
      .data(land.features)
      .enter()
      .append("path")
      .attr("class", "land")
      .attr("d", path)
      .style("fill", "#aca")
      .style("stroke", "#ccc")
      .style("stroke-width", 1);


  var statesEnter = my.selectAll(".state")
    .data(states.features)
    .enter()
    	.append('path')
    		.attr('d',path)
    		.attr('fill','none')
    		.attr('stroke','#ddd')


//
//  statesEnter.append("clipPath")
//    .attr("class","mask")
//    .attr("id",function(d){return "clip"+d.properties.id;})
//    .append("path")
//    .attr("d",path);
//
//  statesEnter.append("image")
//      //.attr("xlink:href",function(d){return flags[d.properties.id].img;})
//      .attr("xlink:href",function(d){return '//static.aga.my/bendera/circle/'+d.properties.id+'.svg';})
//      .attr("x", function(d){return path.bounds(d)[0][0];})
//      .attr("y", function(d){return path.bounds(d)[0][1];})
//      .attr("width", function(d){var bounds = path.bounds(d); return bounds[1][0] - bounds[0][0];})
//      .attr("height", function(d){var bounds = path.bounds(d); return bounds[1][1] - bounds[0][1];})
//      .attr("preserveAspectRatio","none")
//      .attr("clip-path", function(d){return "url(#clip"+d.properties.id+")";});
//
//  statesEnter.append("path")
//    .attr("class", "states")
//    .attr("d", path)
//    .style("stroke", "white")
//    .style("fill", "none")
//    .style("stroke-width", "1px")
//    ;

//  my
//    .append("path")
//      .style("fill","none")
//      //.style("stroke","#000")
//      .style("stroke",'none')
//      //.attr("d", projection.getCompositionBorders());
//      .attr("d", path);

});






//=====================
// load districts from google sheets
// sheet: https://docs.google.com/spreadsheets/d/17vLxlZGl1cOTpjFqQhh1x_ABVKbh4muUOh1hFK0XYhg/edit?usp=sharing
// csv: https://docs.google.com/spreadsheets/d/e/2PACX-1vR94XOsvxFUtkF_csctKSZpAFmbFBN6_F7CKD9Boww_11al2PlMILTZOOCtC5FVC2keEqHW_KvQpBeC/pub?gid=572100186&single=true&output=csv
//=====================
/*
d3.csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vR94XOsvxFUtkF_csctKSZpAFmbFBN6_F7CKD9Boww_11al2PlMILTZOOCtC5FVC2keEqHW_KvQpBeC/pub?gid=572100186&single=true&output=csv')
  .then(function(raw){

    console.log('raw', raw);

    let data = raw.filter(d=>d.Longitude && d.Latitude)
                  .map(d=>{
                    d.longitude = +d.Longitude;
                    d.latitude = +d.Latitude;
                    return d;
                  })

    console.log('data', data);

    // https://www.d3indepth.com/geographic/

    svg.append('g').attr('class','cities-malaysia')
      .selectAll('circle').data(data)
      .enter()
        .append('circle')
          .attr('cx', d=>projection([d.longitude,d.latitude])[0])
          .attr('cy', d=>projection([d.longitude,d.latitude])[1])
          .attr('r',3)
          .attr('fill','magenta')


    svg.append('g').attr('class','cities-malaysia-label')
      .selectAll('text').data(data)
      .enter()
        .append('text')
          .attr('x', d=>projection([d.longitude,d.latitude])[0])
          .attr('y', d=>projection([d.longitude,d.latitude])[1])
          .attr('fill','purple')
          .attr('text-anchor','middle')
          .attr('font-size','60%')
          .attr('transform','translate(0,-7)')
          .text(d=>d.Daerah);



  });
*/

</script>
<br>
<p>Shift Borneo by -5 degree longitude</p>

<br>
<button onclick="document.location='index.html'">Main Menu</button>
<button onclick="document.location='index2.html'">Back</button>
<button onclick="document.location='index4.html'">Next</button>
</body>
</html>
